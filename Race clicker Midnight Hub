-- Constants stored in encrypted format
local ENCRYPTED_CONSTANTS = {
    GUI_NAME = "UmFjZSBDbGlja2Vy",  -- Base64 encoded
    ORION_URL = game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"),
    DEFAULT_EGG = "Starter01"
}

-- Secure remote calls
local RemoteService = {
    Click = game:GetService("ReplicatedStorage").Packages.Knit.Services.ClickService.RF.Click,
    Pets = game:GetService("ReplicatedStorage").Packages.Knit.Services.PetsService.RF.EquipBest,
    Egg = game:GetService("ReplicatedStorage").Packages.Knit.Services.EggService.RF.Open,
    Rebirth = game:GetService("ReplicatedStorage").Packages.Knit.Services.RebirthService.RF.Rebirth
}

-- Protected variables with closures
local protected = {
    autoFarm = false,
    autoPets = false,
    autoHatch = false,
    autoRebirth = false,
    selectedEgg = ENCRYPTED_CONSTANTS.DEFAULT_EGG
}

-- Secure teleport function with validation
local function secureTeleport(targetCFrame)
    local character = game.Players.LocalPlayer.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end
    
    -- Validate CFrame
    if typeof(targetCFrame) ~= "CFrame" then return end
    
    -- Add random offset for anti-detection
    local offset = Vector3.new(math.random(-1, 1), 0, math.random(-1, 1))
    character.HumanoidRootPart.CFrame = targetCFrame * CFrame.new(offset)
end

-- Main farming function with error handling
local function startAutoFarm()
    spawn(function()
        while protected.autoFarm do
            pcall(function()
                RemoteService.Click:InvokeServer()
                secureTeleport(CFrame.new(-442300, 26, 13))
                task.wait(math.random(1, 3)/10) -- Randomized delays
                secureTeleport(CFrame.new(-442100, 26, 13))
            end)
            task.wait()
        end
    end)
end

-- Create secured GUI
local OrionLib = loadstring(ENCRYPTED_CONSTANTS.ORION_URL)()
local Window = OrionLib:MakeWindow({
    Name = ENCRYPTED_CONSTANTS.GUI_NAME,
    HidePremium = false,
    SaveConfig = true,
    ConfigFolder = "SecuredRaceClicker"
})

-- Main Tab with secured callbacks
local MainTab = Window:MakeTab({
    Name = "Main",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

MainTab:AddToggle({
    Name = "Auto Farm",
    Default = false,
    Callback = function(value)
        protected.autoFarm = value
        if value then startAutoFarm() end
    end
})

-- Add other toggles and features here following the same pattern

-- Secure player modifications
local PlayerTab = Window:MakeTab({
    Name = "Player",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

PlayerTab:AddSlider({
    Name = "WalkSpeed",
    Min = 0,
    Max = 500, -- Reduced max value for better anti-detection
    Default = 16,
    Color = Color3.fromRGB(255,255,255),
    Increment = 1,
    ValueName = "Speed",
    Callback = function(value)
        pcall(function()
            local character = game.Players.LocalPlayer.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid.WalkSpeed = value
            end
        end)
    end
})

-- Add other features similarly

-- Anti-tampering check
spawn(function()
    while task.wait(1) do
        if not protected then
            game.Players.LocalPlayer:Kick("Script tampering detected")
            break
        end
    end
end)

OrionLib:Init()

-- Cleanup handler
game.Players.LocalPlayer.OnTeleport:Connect(function()
    OrionLib:Destroy()
end)
