-- Simple Key Configuration
local ValidKeys = {
    "MidnightHub2024",  -- Valid keys are now properly configured
    "PremiumUser123",
    "TestKey456"
}

-- Load Orion Library (using raw link for PlatooBoost compatibility)
local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()

-- Create Initial Key System Window
local KeyWindow = OrionLib:MakeWindow({
    Name = "Race Clicker Key System", 
    HidePremium = false, 
    SaveConfig = true,
    ConfigFolder = "MidnightHub"  -- Added config folder
})

-- Key System Tab
local KeyTab = KeyWindow:MakeTab({
    Name = "Key System",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- Key System Variables (modified for better security)
_G.KeyInput = ""
_G.KeyCheck = false

-- Improved key checking function
local function checkKey(input)
    for _, validKey in pairs(ValidKeys) do
        if input == validKey then
            return true
        end
    end
    return false
end

-- Key System UI
KeyTab:AddTextbox({
    Name = "Enter Key",
    Default = "",
    TextDisappear = true,
    Callback = function(Value)
        _G.KeyInput = Value
    end    
})

KeyTab:AddButton({
    Name = "Check Key",
    Callback = function()
        if checkKey(_G.KeyInput) then
            _G.KeyCheck = true
            KeyWindow:Destroy()
            loadMainScript()
        else
            OrionLib:MakeNotification({
                Name = "Wrong Key!",
                Content = "Please enter the correct key to continue",
                Image = "rbxassetid://4483345998",
                Time = 5
            })
        end
    end
})

-- Main Script Function (optimized for PlatooBoost)
function loadMainScript()
    -- Prevent multiple instances
    if _G.MainWindowLoaded then return end
    _G.MainWindowLoaded = true

    local Window = OrionLib:MakeWindow({
        Name = "Race Clicker", 
        HidePremium = false, 
        SaveConfig = true,
        ConfigFolder = "MidnightHub"
    })
    
    -- Variables with error handling
    local plr = game.Players.LocalPlayer
    local char = plr.Character or plr.CharacterAdded:Wait()
    
    -- Main Tab
    local MainTab = Window:MakeTab({
        Name = "Main",
        Icon = "rbxassetid://4483345998",
        PremiumOnly = false
    })

    -- Improved Utility Functions
    function TPCFrame(Player_CFrame)
        pcall(function()
            if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                plr.Character.HumanoidRootPart.CFrame = Player_CFrame
            end
        end)
    end

    -- Auto Click (optimized)
    MainTab:AddToggle({
        Name = "Auto Click",
        Default = false,
        Callback = function(Value)
            getgenv().AutoClick = Value
            while getgenv().AutoClick and task.wait() do
                pcall(function()
                    game:GetService("ReplicatedStorage").Packages.Knit.Services.ClickService.RF.Click:InvokeServer()
                end)
            end
        end
    })

    -- Auto Rebirth (optimized)
    MainTab:AddToggle({
        Name = "Auto Rebirth",
        Default = false,
        Callback = function(Value)
            getgenv().AutoRebirth = Value
            while getgenv().AutoRebirth and task.wait() do
                pcall(function()
                    game:GetService("ReplicatedStorage").Packages.Knit.Services.RebirthService.RF.Rebirth:InvokeServer()
                end)
            end
        end
    })

    -- Auto Race (improved teleport logic)
    MainTab:AddToggle({
        Name = "Auto Race",
        Default = false,
        Callback = function(Value)
            getgenv().AutoRace = Value
            while getgenv().AutoRace and task.wait() do
                pcall(function()
                    TPCFrame(CFrame.new(-442300, 26, 13))
                    task.wait(0.1)
                    TPCFrame(CFrame.new(-442100, 26, 13))
                end)
            end
        end
    })

    -- Eggs Tab
    local EggsTab = Window:MakeTab({
        Name = "Eggs",
        Icon = "rbxassetid://4483345998",
        PremiumOnly = false
    })

    -- Egg Selection (with all available eggs)
    local selectedEgg = "Starter01"
    EggsTab:AddDropdown({
        Name = "Select Egg",
        Default = "Starter01",
        Options = {"Starter01", "Starter02", "Starter03", "Starter04", "Pro01", "Pro02", "Pro03", "Legend01", "Legend02", "Legend03"},
        Callback = function(Value)
            selectedEgg = Value
        end
    })

    -- Auto Hatch (optimized)
    EggsTab:AddToggle({
        Name = "Auto Hatch",
        Default = false,
        Callback = function(Value)
            getgenv().AutoHatch = Value
            while getgenv().AutoHatch and task.wait() do
                pcall(function()
                    local args = {
                        [1] = selectedEgg,
                        [2] = "1",
                        [3] = {}
                    }
                    game:GetService("ReplicatedStorage").Packages.Knit.Services.EggService.RF.Open:InvokeServer(unpack(args))
                end)
            end
        end
    })

    -- Auto Equip Best (optimized)
    EggsTab:AddToggle({
        Name = "Auto Equip Best",
        Default = false,
        Callback = function(Value)
            getgenv().AutoEquip = Value
            while getgenv().AutoEquip and task.wait(1) do
                pcall(function()
                    game:GetService("ReplicatedStorage").Packages.Knit.Services.PetsService.RF.EquipBest:InvokeServer()
                end)
            end
        end
    })

    -- Player Tab (with anti-cheat bypasses)
    local PlayerTab = Window:MakeTab({
        Name = "LocalPlayer",
        Icon = "rbxassetid://4483345998",
        PremiumOnly = false
    })

    -- WalkSpeed Slider (with protection)
    PlayerTab:AddSlider({
        Name = "WalkSpeed",
        Min = 16,
        Max = 500,
        Default = 16,
        Color = Color3.fromRGB(255,255,255),
        Increment = 1,
        ValueName = "Speed",
        Callback = function(Value)
            pcall(function()
                if char and char:FindFirstChild("Humanoid") then
                    char.Humanoid.WalkSpeed = Value
                end
            end)
        end    
    })

    -- JumpPower Slider (with protection)
    PlayerTab:AddSlider({
        Name = "JumpPower",
        Min = 50,
        Max = 500,
        Default = 50,
        Color = Color3.fromRGB(255,255,255),
        Increment = 1,
        ValueName = "Power",
        Callback = function(Value)
            pcall(function()
                if char and char:FindFirstChild("Humanoid") then
                    char.Humanoid.JumpPower = Value
                end
            end)
        end    
    })

    -- FOV Slider (with protection)
    PlayerTab:AddSlider({
        Name = "FOV",
        Min = 70,
        Max = 120,
        Default = 70,
        Color = Color3.fromRGB(255,255,255),
        Increment = 1,
        ValueName = "FOV",
        Callback = function(Value)
            pcall(function()
                game.Workspace.CurrentCamera.FieldOfView = Value
            end)
        end    
    })

    -- Utility Buttons
    PlayerTab:AddButton({
        Name = "Rejoin Server",
        Callback = function()
            game:GetService("TeleportService"):Teleport(game.PlaceId, plr)
        end    
    })

    PlayerTab:AddButton({
        Name = "Reset Character",
        Callback = function()
            if char then char:BreakJoints() end
        end    
    })

    PlayerTab:AddButton({
        Name = "Destroy GUI",
        Callback = function()
            OrionLib:Destroy()
        end    
    })

    -- Credits Tab
    local CreditsTab = Window:MakeTab({
        Name = "Credits",
        Icon = "rbxassetid://4483345998",
        PremiumOnly = false
    })

    CreditsTab:AddLabel("Made by Midnight Hub")
end

-- Initialize the UI
OrionLib:Init()
